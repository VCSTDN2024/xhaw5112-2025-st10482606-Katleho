<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Empowering The Nation - Payment</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body class="min-h-screen bg-gray-50">

  <!-- Header -->
    <header class="bg-gradient-to-r from-purple-900 to-black shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full overflow-hidden">
                            <img src="media/logo.png" alt="Empowering The Nation Logo" class="w-full h-full object-cover">
                        </div>
                    </a>
                </div>

        <nav class="hidden md:flex space-x-8">
          <a href="index.html" class="text-white hover:text-yellow-400 px-3 py-2 rounded-md transition-colors">Home</a>
          <a href="courses.html" class="text-white hover:text-yellow-400 px-3 py-2 rounded-md transition-colors">Courses</a>
          <a href="contact.html" class="text-white hover:text-yellow-400 px-3 py-2 rounded-md transition-colors">Contact</a>
        </nav>

        <div class="flex items-center">
          <span class="bg-yellow-500 text-black px-4 py-2 rounded-lg">
            <span class="mr-2">Payment</span>
            <span id="cart-count" class="bg-purple-900 text-white text-xs rounded-full px-2 py-1 ml-2">0</span>
          </span>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="py-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-6 text-center">Payment</h1>

      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Payment Form (left) -->
        <div class="lg:col-span-2 bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-semibold mb-4">Payment Details</h2>
          <form id="payment-form" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">Full Name</label>
              <input id="name" type="text" required class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Email</label>
              <input id="email" type="email" required class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Card Number</label>
              <input id="card-number" type="text" maxlength="19" required placeholder="1234 5678 9012 3456" class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Expiry</label>
                <input id="expiry" type="text" placeholder="MM/YY" required class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">CVV</label>
                <input id="cvv" type="text" maxlength="4" required class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
              </div>
            </div>

            <div class="border-t pt-4">
              <label class="flex items-start space-x-3">
                <input type="checkbox" id="terms" required class="mt-1">
                <span class="text-sm text-gray-600">
                  I agree to the <a href="#" class="text-purple-600 hover:text-purple-800">Terms</a> and <a href="#" class="text-purple-600 hover:text-purple-800">Privacy Policy</a>.
                </span>
              </label>
            </div>

            <div>
              <button id="complete-payment" type="submit" class="w-full bg-purple-900 hover:bg-purple-800 text-white px-6 py-3 rounded-lg font-semibold">
                Complete Payment
              </button>
            </div>
          </form>
        </div>

        <!-- Order Summary (right) -->
        <div class="bg-white rounded-lg shadow-md p-6 sticky top-24">
          <h3 class="text-xl font-bold mb-4">Order Summary</h3>

          <div id="payment-course-list" class="space-y-3 mb-6">
            <!-- filled by JS -->
          </div>

          <div class="border-t pt-4 space-y-2">
            <div class="flex justify-between text-gray-600">
              <span>Subtotal:</span>
              <span id="payment-subtotal">R0</span>
            </div>
            <div id="payment-discount-row" class="flex justify-between text-green-600 hidden">
              <span id="payment-discount-label">Discount:</span>
              <span id="payment-discount-amount">-R0</span>
            </div>
            <div class="flex justify-between text-lg font-bold border-t pt-2">
              <span>Total:</span>
              <span id="payment-total">R0</span>
            </div>
          </div>
          <div class="mt-6 space-y-3">
            <a id="back-to-courses" href="courses.html" class="block w-full text-center bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg font-semibold">
              ← Back to Courses
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-black text-white py-8 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-gray-500">© 2024 Empowering The Nation. All rights reserved.</p>
    </div>
  </footer>

  <!-- JS -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const courseListEl = document.getElementById('payment-course-list');
      const subtotalEl = document.getElementById('payment-subtotal');
      const discountRow = document.getElementById('payment-discount-row');
      const discountLabel = document.getElementById('payment-discount-label');
      const discountAmountEl = document.getElementById('payment-discount-amount');
      const totalEl = document.getElementById('payment-total');
      const cartCountEl = document.getElementById('cart-count');

      // Load selected courses safely
      let selectedCourses = [];
      try {
        selectedCourses = JSON.parse(localStorage.getItem('selectedCourses') || '[]');
        if (!Array.isArray(selectedCourses)) selectedCourses = [];
      } catch (err) {
        selectedCourses = [];
      }

      // If there are no selected courses, show a friendly message
      if (!selectedCourses.length) {
        courseListEl.innerHTML = '<div class="text-gray-600">No courses selected. Please go back to <a class="text-purple-700" href="courses.html">Courses</a>.</div>';
        subtotalEl.textContent = 'R0';
        totalEl.textContent = 'R0';
        cartCountEl.textContent = '0';
        discountRow.classList.add('hidden');
        return;
      }

      // Render courses
      selectedCourses.forEach(c => {
        const row = document.createElement('div');
        row.className = 'flex justify-between text-gray-700';
        row.innerHTML = `<span>${c.title}</span><span>R${Number(c.price)}</span>`;
        courseListEl.appendChild(row);
      });

      // Calculate subtotal from the actual saved list (robust)
      const subtotal = selectedCourses.reduce((s, c) => s + Number(c.price), 0);

      // Discount rules:
      // 1 course = 0%
      // 2 courses = 5%
      // 3 courses = 10%
      // >3 courses = 15%
      let discountRate = 0;
      const n = selectedCourses.length;
      if (n === 2) discountRate = 0.05;
      else if (n === 3) discountRate = 0.10;
      else if (n > 3) discountRate = 0.15;

      const discountAmount = Math.round(subtotal * discountRate);
      const total = subtotal - discountAmount;

      // Update UI
      subtotalEl.textContent = `R${subtotal}`;
      if (discountRate > 0) {
        discountRow.classList.remove('hidden');
        discountLabel.textContent = `Discount (${discountRate * 100}%)`;
        discountAmountEl.textContent = `-R${discountAmount}`;
      } else {
        discountRow.classList.add('hidden');
      }
      totalEl.textContent = `R${total}`;

      // Update header cart count
      cartCountEl.textContent = n;

      // Payment form submit
      const paymentForm = document.getElementById('payment-form');
      paymentForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // (Here you'd normally call your payment API.)
        // For demo: clear just the selected items and redirect to thank you.
        localStorage.removeItem('selectedCourses');
        localStorage.removeItem('totalAmount');

        // Visual feedback
        alert('Payment simulated. Thank you — redirecting to confirmation.');
        window.location.href = 'thankyou.html';
      });
    });
  </script>
</body>
</html>

